# NKP Deployment Environment Variables
# Copy this file to environment.env and fill in your values
# Source this file before running deployment: source environment.env

# =============================================================================
# CLUSTER CONFIGURATION
# =============================================================================
export CLUSTER_NAME="nkp-mgmt"

# =============================================================================
# NODE ADDRESSES
# =============================================================================
# Control Plane Nodes (3 for HA)
export CONTROL_PLANE_1_ADDRESS="192.168.1.51"
export CONTROL_PLANE_2_ADDRESS="192.168.1.52"
export CONTROL_PLANE_3_ADDRESS="192.168.1.53"

# Worker Nodes (minimum 4 recommended)
export WORKER_1_ADDRESS="192.168.1.61"
export WORKER_2_ADDRESS="192.168.1.62"
export WORKER_3_ADDRESS="192.168.1.63"
export WORKER_4_ADDRESS="192.168.1.64"

# Combined lists for scripts
export CONTROL_PLANE_NODES="${CONTROL_PLANE_1_ADDRESS} ${CONTROL_PLANE_2_ADDRESS} ${CONTROL_PLANE_3_ADDRESS}"
export WORKER_NODES="${WORKER_1_ADDRESS} ${WORKER_2_ADDRESS} ${WORKER_3_ADDRESS} ${WORKER_4_ADDRESS}"
export ALL_NODES="${CONTROL_PLANE_NODES} ${WORKER_NODES}"

# =============================================================================
# CONTROL PLANE ENDPOINT
# =============================================================================
# Virtual IP for Kubernetes API server (must be unused IP in same subnet)
export CONTROL_PLANE_ENDPOINT_HOST="192.168.1.100"
export CONTROL_PLANE_ENDPOINT_PORT="6443"

# Virtual IP interface (for kube-vip, leave empty for auto-detect)
export VIRTUAL_IP_INTERFACE=""

# =============================================================================
# SSH CONFIGURATION
# =============================================================================
export SSH_USER="konvoy"
export SSH_PRIVATE_KEY_FILE="${HOME}/.ssh/id_rsa"
export SSH_PRIVATE_KEY_SECRET_NAME="${CLUSTER_NAME}-ssh-key"

# =============================================================================
# NETWORKING
# =============================================================================
# MetalLB IP range (must be in same subnet as nodes, not overlapping DHCP)
export METALLB_IP_RANGE="192.168.1.240-192.168.1.250"

# Pod and Service CIDRs (defaults usually work)
export POD_CIDR="10.244.0.0/16"
export SERVICE_CIDR="10.96.0.0/12"

# =============================================================================
# PROXY CONFIGURATION (if required)
# =============================================================================
export HTTP_PROXY=""
export HTTPS_PROXY=""
export NO_PROXY="localhost,127.0.0.1,.local,${CONTROL_PLANE_NODES// /,},${WORKER_NODES// /,}"

# =============================================================================
# STORAGE CONFIGURATION
# =============================================================================
# Storage provider: nutanix-csi | rook-ceph | local-volume-provisioner
export STORAGE_PROVIDER="local-volume-provisioner"

# Nutanix CSI configuration (if using Nutanix storage)
export NUTANIX_ENDPOINT=""
export NUTANIX_USER=""
export NUTANIX_PASSWORD=""
export NUTANIX_CLUSTER_UUID=""
export STORAGE_CONTAINER=""

# =============================================================================
# LICENSE
# =============================================================================
# License type: starter | pro | ultimate
export LICENSE_TYPE="pro"

# License token (get from Nutanix Support Portal)
export NKP_LICENSE_TOKEN=""

# =============================================================================
# REGISTRY CONFIGURATION
# =============================================================================
# Docker Hub credentials (to avoid rate limiting)
export REGISTRY_MIRROR_URL="https://registry-1.docker.io"
export REGISTRY_MIRROR_USERNAME=""
export REGISTRY_MIRROR_PASSWORD=""

# =============================================================================
# AIR-GAPPED CONFIGURATION (only for air-gapped deployments)
# =============================================================================
export AIRGAPPED="false"

# Local registry for air-gapped
export LOCAL_REGISTRY_URL=""
export LOCAL_REGISTRY_CA_CERT=""
export LOCAL_REGISTRY_USERNAME=""
export LOCAL_REGISTRY_PASSWORD=""

# Bundle paths
export NKP_BUNDLE_PATH=""
export KONVOY_IMAGE_BUNDLE=""
export KOMMANDER_IMAGE_BUNDLE=""
export KOMMANDER_CHARTS_BUNDLE=""

# =============================================================================
# OUTPUT PATHS
# =============================================================================
export OUTPUT_DIR="${PWD}/nkp-output"
export KUBECONFIG_PATH="${OUTPUT_DIR}/${CLUSTER_NAME}.conf"

# =============================================================================
# TIMEOUTS
# =============================================================================
export CLUSTER_CREATE_TIMEOUT="60m"
export KOMMANDER_INSTALL_TIMEOUT="45m"
export NODE_READY_TIMEOUT="30m"

# =============================================================================
# ADVANCED OPTIONS
# =============================================================================
# Enable verbose output
export VERBOSE="false"

# Dry run mode (don't actually deploy)
export DRY_RUN="false"

# FIPS mode
export FIPS_MODE="false"

# =============================================================================
# DERIVED VARIABLES (do not modify)
# =============================================================================
export CONTROL_PLANE_REPLICAS=$(echo ${CONTROL_PLANE_NODES} | wc -w)
export WORKER_REPLICAS=$(echo ${WORKER_NODES} | wc -w)
